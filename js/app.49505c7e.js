(function(t){function e(e){for(var o,n,a=e[0],l=e[1],c=e[2],u=0,d=[];u<a.length;u++)n=a[u],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&d.push(i[n][0]),i[n]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);h&&h(e);while(d.length)d.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],o=!0,a=1;a<s.length;a++){var l=s[a];0!==i[l]&&(o=!1)}o&&(r.splice(e--,1),t=n(n.s=s[0]))}return t}var o={},i={app:0},r=[];function n(e){if(o[e])return o[e].exports;var s=o[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=o,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(s,o,function(e){return t[e]}.bind(null,o));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/midi-test/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=e,a=a.slice();for(var c=0;c<a.length;c++)e(a[c]);var h=l;r.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";s("85ec")},"4c7f":function(t,e,s){"use strict";s("c82b")},"519a":function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var o=s("2b0e"),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("MidiDemo")],1)},r=[],n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page"},[s("h1",[t._v("Here is a midi display demo by Molar~")]),s("Waveform")],1)},a=[],l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-row",{attrs:{id:"datasource"}},[s("el-col",{attrs:{span:24}},[s("el-card",{staticClass:"box-card",staticStyle:{"text-align":"left"},attrs:{"body-style":{padding:"5px 20px"}}},[s("div",{staticClass:"clearfix title",staticStyle:{display:"flex","align-items":"center"},attrs:{slot:"header"},slot:"header"},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"音轨背景色",placement:"bottom"}},[s("el-color-picker",{attrs:{"show-alpha":"",size:"mini"},on:{"active-change":t.changeBackgroundColor},model:{value:t.wvBackgroundColor,callback:function(e){t.wvBackgroundColor=e},expression:"wvBackgroundColor"}})],1),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"未播放音轨颜色",placement:"bottom"}},[s("el-color-picker",{staticStyle:{"margin-left":"15px"},attrs:{"show-alpha":"",size:"mini"},on:{"active-change":t.changeWaveColor},model:{value:t.wvWaveColor,callback:function(e){t.wvWaveColor=e},expression:"wvWaveColor"}})],1),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"已播放音轨颜色",placement:"bottom"}},[s("el-color-picker",{staticStyle:{"margin-left":"15px"},attrs:{"show-alpha":"",size:"mini"},on:{"active-change":t.changeProgressColor},model:{value:t.wvProgressColor,callback:function(e){t.wvProgressColor=e},expression:"wvProgressColor"}})],1),s("el-button",{staticStyle:{"margin-left":"30px"},attrs:{type:"primary",size:"mini"},on:{click:t.resetColor}},[t._v("重置")]),"STUDY_MODE"==t.mode&&t.taskIdShow?s("span",{staticStyle:{position:"absolute",right:"20px"}},[s("el-tag",[t._v("任务Id "+t._s(this.taskId))]),s("el-tag",[t._v("itemId "+t._s(this.itemId))]),s("el-tag",[t._v("学习进度 "+t._s(this.studyNumPass)+" / "+t._s(this.studyNumAll))])],1):t._e(),t.taskIdShow&&"STUDY_MODE"!=t.mode&&"CHECK_MODE"!=t.mode?s("span",{staticStyle:{position:"absolute",right:"20px"}},[s("el-tag",[t._v("任务uid:"+t._s(this.uid))]),s("el-tag",[t._v("taskId:"+t._s(this.taskId))]),s("el-tag",[t._v(t._s(this.audioName))]),"LABEL_MODE "!=t.mode?s("el-tag",[t._v("审核员:"+t._s(t.checkUserName?t.checkUserName:t.checkUserId))]):t._e()],1):t._e(),t.taskIdShow&&"CHECK_MODE"==t.mode?s("span",{staticStyle:{position:"absolute",right:"20px"}},[s("el-tag",[t._v("任务uid:"+t._s(this.uid))]),s("el-tag",[t._v("taskId:"+t._s(this.taskId))]),s("el-tag",[t._v(t._s(this.audioName))]),s("el-tag",[t._v("标注员："+t._s(t.labelUserName))])],1):t._e()],1),s("div",[s("div",{ref:"waveform",attrs:{id:"waveform"}}),s("div",{ref:"wave-timeline",attrs:{id:"wave-timeline"}})]),s("div",{staticClass:"ScrollArea",attrs:{id:"test"}},[s("div",{staticClass:"container",attrs:{id:"container"}},[s("div",{staticClass:"piano"},[s("piano")],1),s("div",{staticClass:"roll"},[s("div",{attrs:{id:"root"}},[s("div",{attrs:{id:"RollContainer"}},[s("div",{attrs:{id:"ScrollContainer"}},[s("div",{attrs:{id:"PianoRoll"}}),s("div",{attrs:{id:"line"}})]),s("canvas",{attrs:{id:"ScoreCanvas"}})])])])])]),s("el-row",{staticStyle:{"margin-top":"20px"}},[s("el-select",{staticStyle:{margin:"10px 10px"},attrs:{placeholder:"当前未选择"},on:{change:t.onChange},model:{value:t.tmpvalue,callback:function(e){t.tmpvalue=e},expression:"tmpvalue"}},t._l(t.tracks,(function(t){return s("el-option",{key:"track"+t.index,attrs:{label:"Track:"+t.index+" Instrument:"+t.instrument.name,value:t.index}})})),1),s("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",size:"small"},on:{click:t.playMusic}},[s("i",{staticClass:"el-icon-video-play"}),t._v(" 播放 / "),s("i",{staticClass:"el-icon-video-pausee"}),t._v(" 暂停 ")]),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"放大倍率",placement:"bottom"}},[s("el-input-number",{attrs:{size:"small",precision:0,step:20,min:80,max:1500},on:{change:t.changeZoom},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",onfocus:"this.blur()"},on:{click:t.changeLongHotKey}},[t._v("一键放大")]),s("el-button",{attrs:{size:"small",onfocus:"this.blur()"},on:{click:t.changeShortHotKey}},[t._v("一键缩小")]),s("el-button",{attrs:{type:"primary",size:"small",onfocus:"this.blur()"},on:{click:t.preview}},[t._v("预览")]),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"预览时长",placement:"bottom"}},[s("el-popover",{staticStyle:{"margin-left":"10px"},attrs:{placement:"top",width:"220",trigger:"click"}},[s("el-input-number",{attrs:{width:"180",precision:2,step:.1,min:.1,max:10},on:{change:t.changeSpace},model:{value:t.previewTime,callback:function(e){t.previewTime=e},expression:"previewTime"}}),s("el-button",{attrs:{slot:"reference",size:"small",round:""},slot:"reference"},[t._v(" "+t._s(t.previewTime+" s")+" ")])],1)],1),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small",disabled:t.getButtonAttr,onfocus:"this.blur()"},on:{click:t.getTask}},[t._v("领取任务 ")])],1)],1)],1)],1)],1)},c=[],h=(s("4160"),s("fb6a"),s("a9e3"),s("b680"),s("b64b"),s("ac1f"),s("1276"),s("159b"),s("96cf"),s("1da1")),u=s("b85c"),d=s("8896"),f=s.n(d),v=s("e3bf"),m=s.n(v),g=s("c1be"),p=s.n(g),w=s("8433"),y=s.n(w),_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"keyboard",style:t.style},[s("ul",t._l(t.keys,(function(e,o){return s("li",{key:o,class:[].concat(e.class),style:e.style},[-1!=e.name.indexOf("C")&&-1===e.name.indexOf("#")?s("span",[t._v(t._s(e.name))]):t._e()])})),0)])},k=[],b=(s("99af"),["C","D","E","F","G","A","B"]),C=["C#","D#",null,"F#","G#","A#",null],x=7,S=5,T=-1,O=9,P=0,L=6,E=function(t,e,s){return Math.max(e,Math.min(s,t))},B={data:function(){return{offsets:{octaveStart:-1,octaveEnd:9,noteStart:0,noteEnd:4}}},methods:{calculateOctave:function(t){return Math.floor(t/x)+Math.max(T,this.offsets.octaveStart)}},computed:{offsetStart:function(){return E(this.offsets.noteStart,P,L)},offsetEnd:function(){return E(this.offsets.noteEnd,P,L)},totalWhiteKeys:function(){return this.numOctaves*x-this.offsets.noteStart-(x-(this.offsets.noteEnd+1))},totalBlackKeys:function(){return this.numOctaves*S-this.offsets.noteStart-(S-(this.offsets.noteEnd+1))},totalKeys:function(){return this.totalWhiteKeys+this.totalBlackKeys},numOctaves:function(){return Math.min(O,this.offsets.octaveEnd)-Math.max(T,this.offsets.octaveStart)+1},style:function(){return{"--keys":this.totalWhiteKeys,"--octaves":this.numOctaves}},keys:function(){for(var t=[],e=1,s=this.offsetStart,o=0;o<this.totalWhiteKeys;s++,o++){var i=this.calculateOctave(s),r=b[s%7],n=3;s%7!==1&&s%7!==4&&s%7!==5||(n=4);var a={name:"".concat(r).concat(i),class:["white"],style:{"grid-row":"".concat(e," / span ").concat(n)}};e+=n,t.push(a)}e=0;for(var l=this.offsetStart,c=0;c<this.totalWhiteKeys;l++,c++){var h=3;l%7!==1&&l%7!==4&&l%7!==5||(h=4),e+=h;var u=this.calculateOctave(l),d=C[l%7];if(d&&(!(u>=10)&&(9!==u||l%7!==4))){var f={name:"".concat(d).concat(u),class:["black"],style:{"grid-row":"".concat(e," / span 2")}};t.push(f)}}return t}}},M=B,W=(s("9747"),s("2877")),I=Object(W["a"])(M,_,k,!1,null,"746bffe9",null),N=I.exports,D=s("ef75"),A=s("d4ec"),z=s("bee2"),R=s("4393"),H=s.n(R),j=(s("b0c0"),s("5e54")),K=function(){function t(e,s){Object(A["a"])(this,t),this.noteOn=j["a"].toSeconds(e.time),this.duration=j["a"].toSeconds(e.duration),this.noteOff=this.noteOn+this.duration,this.strokeColor="#A2F0B1",this.fillColor="#217230",this.note=e.name,this.velocity=e.velocity,this.midiNote=e.midi;var o=this.midiNote;o*=s.noteHeight,this.top=o,this.left=this.noteOn*s.pixelsPerSecond,this.width=this.duration*s.pixelsPerSecond,this.height=s.noteHeight}return Object(z["a"])(t,[{key:"draw",value:function(t){t.beginPath(),t.fillStyle=this.fillColor,t.strokeStyle=this.strokeColor,t.fillRect(2*this.left,2*this.top,2*this.width,2*this.height);var e=Math.min(Math.min(this.width,6),Math.min(this.height,6)),s=2*this.height-2*e;s>=this.width?t.lineWidth=this.width:t.lineWidth=s,t.beginPath(),t.moveTo(2*this.left+e+s/2,2*this.top+e+s/2),t.lineTo(2*this.left+2*this.width-e-s/2,2*this.top+e+s/2),t.closePath(),t.lineJoin="round",t.stroke()}},{key:"dispose",value:function(){this.element.remove(),this.element=null}}]),t}(),U=function(){function t(e,s,o){Object(A["a"])(this,t),this.notes=[],this.bpm=o,this.pixelsPerSecond=200,this.element=e,this.currentlyDisplayedNotes=[],this.intervalTree=null,this.width=0,this.scrollC=s,this.canvas=document.getElementById("ScoreCanvas"),this.canvasWidth=0,this.canvasHeight=0,this.context=this.canvas.getContext("2d"),window.addEventListener("resize",this.resize.bind(this)),this.resize(),this._currentNotes=null}return Object(z["a"])(t,[{key:"setNotes",value:function(t,e){this._currentNotes=t,this.clearNotes();var s=(this.scrollC.offsetHeight-25)/128,o={min:0,max:127,pixelsPerSecond:this.pixelsPerSecond,noteHeight:s};this.intervalTree=new H.a;for(var i=127,r=0;r<t.length;r++){var n=new K(t[r],o);n.midiNote<i&&(i=n.midiNote),this.intervalTree.insert([n.noteOn,n.noteOff,n])}return console.log(e*this.pixelsPerSecond),this.width=e*this.pixelsPerSecond,this.element.style.width=this.width+"px",Math.round(s*Math.min(100,Math.max(i-1,0)))}},{key:"resize",value:function(){this.canvasWidth=2*this.canvas.offsetWidth,this.canvasHeight=2*this.canvas.offsetHeight,this.context.canvas.width=this.canvasWidth,this.context.canvas.height=this.canvasHeight,this._currentNotes&&this.setNotes(this._currentNotes)}},{key:"getDuration",value:function(){for(var t=0,e=0;e<this.notes.length;e++)this.notes[e].noteOff>t&&(t=this.notes[e].noteOff);return t}},{key:"showOnScreenNotes",value:function(t,e){var s=t/this.pixelsPerSecond,o=e/this.pixelsPerSecond;if(null!==this.intervalTree){var i=[];this.intervalTree.queryInterval(s,o,(function(t){i.push(t[2])})),this.currentlyDisplayedNotes=i}}},{key:"clearNotes",value:function(){for(var t=0;t<this.notes.length;t++){var e=this.notes[t];e.dispose()}this.notes=[]}},{key:"dispose",value:function(){this.clearNotes(),this.element.remove(),this.element=null}},{key:"draw",value:function(t){this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.context.save(),this.drawBg(t),this.context.translate(2*-t,0);for(var e=this.currentlyDisplayedNotes,s=0;s<e.length;s++){var o=e[s];o.draw(this.context)}this.context.restore()}},{key:"drawBg",value:function(t){for(var e=["#282828","#363636"],s=(this.scrollC.offsetHeight-25)/128*2,o=0;o<128;o++)this.context.strokeStyle=e[o%2],this.context.fillStyle=e[o%2],this.context.fillRect(0,o*s,this.canvasWidth,s);var i,r,n=60*this.pixelsPerSecond/this.bpm;if(this.context.strokeStyle="#fff",this.context.lineWidth=2,n>50){i=this.scrollC.offsetWidth/n*2,r=t%(n/2);for(var a=1;a<=i+1;a++)this.context.beginPath(),this.context.moveTo(a*n-2*r,0),this.context.lineTo(a*n-2*r,this.canvasHeight),this.context.closePath(),this.context.stroke()}else{i=this.scrollC.offsetWidth/n,r=t%n;for(var l=1;l<=i+1;l++)this.context.beginPath(),this.context.moveTo(l*n*2-2*r,0),this.context.lineTo(l*n*2-2*r,this.canvasHeight),this.context.closePath(),this.context.stroke()}}}]),t}(),$=function(){function t(e,s){Object(A["a"])(this,t),this.autoAdvance=!1,this.lastUpdate=-1,this._wavesurfer=s,this._element=document.getElementById("RollContainer"),this._scrollContainer=document.getElementById("ScrollContainer"),this._scrollElement=document.getElementById("PianoRoll"),this._scrollTopArea=document.getElementById("test"),this._line=document.getElementById("line"),this._head=e,this._bpm=Math.round(this._head.tempos[0].bpm),this._score=new U(this._scrollElement,this._scrollContainer,this._bpm),this._started=!1,this._currentNotes=[],this._currentScroll=-1,this._alreadyRun=-1,this._lastFlag=0,this._bindedLoop=this._loop.bind(this),this._width=this._scrollContainer.offsetWidth,document.getElementById("waveform").style.width=document.getElementById("root").offsetWidth+"px",window.addEventListener("resize",this._resize.bind(this)),this._scrollContainer.onscroll=this._onscroll.bind(this),this._scrollElement.onclick=this._onclick.bind(this)}return Object(z["a"])(t,[{key:"_onclick",value:function(t){this._wavesurfer.seekTo(t.offsetX/this._scrollElement.offsetWidth)}},{key:"_onscroll",value:function(){this._wavesurfer.drawer.wrapper.scrollLeft=this._scrollContainer.scrollLeft}},{key:"_resize",value:function(){this._width=this._scrollContainer.offsetWidth,document.getElementById("waveform").style.width=document.getElementById("root").offsetWidth+"px",this._onScreenNotes(),this._score.draw(this._scrollContainer.scrollLeft)}},{key:"_onScreenNotes",value:function(){var t=this._width;this._score.showOnScreenNotes(this._scrollContainer.scrollLeft,this._scrollContainer.scrollLeft+t)}},{key:"changeLineLeft",value:function(t,e,s,o,i){this._alreadyRun=t*this._score.pixelsPerSecond,this._line.style.left=this._alreadyRun+"px";var r=(i-e)*this._score.pixelsPerSecond;s+e<t&&t<=i-e?(this._scrollContainer.scrollLeft=o+this._width,this._onScreenNotes(),this._score.draw(this._scrollContainer.scrollLeft)):t<s?(this._scrollContainer.scrollLeft=t*this._score.pixelsPerSecond,this._onScreenNotes(),this._score.draw(this._scrollContainer.scrollLeft)):t>i-e&&this._scrollContainer.scrollLeft<=r-5&&(this._scrollContainer.scrollLeft=r,this._onscroll(),this._onScreenNotes(),this._score.draw(this._scrollContainer.scrollLeft))}},{key:"changeScrollLeft",value:function(t){this._scrollContainer.scrollLeft=t,this._onScreenNotes(),this._score.draw(this._scrollContainer.scrollLeft)}},{key:"changeSeek",value:function(t){this._alreadyRun=t,this._line.style.left=this._alreadyRun+"px"}},{key:"_loop",value:function(){}},{key:"setScore",value:function(t,e){var s=this._score.setNotes(t.notes,e);this._scrollTopArea.scrollTop=s,console.log(this._scrollTopArea.scrollTop),this._alreadyRun=0,this._currentScroll=0,this._scrollContainer.scrollLeft=this._currentScroll,this._onScreenNotes(),this._score.draw(this._scrollContainer.scrollLeft)}},{key:"start",value:function(){this.autoAdvance=!0}},{key:"stop",value:function(){this.autoAdvance=!1}},{key:"update",value:function(t,e,s){this._head=s;var o=this._score.setNotes(t.notes,e);this._scrollTopArea.scrollTop=o,console.log(this._scrollTopArea.scrollTop),this._onScreenNotes(),this._score.draw(this._scrollContainer.scrollLeft)}},{key:"changeXAxis",value:function(t,e){this._score.pixelsPerSecond=t,this._currentScroll*=t/e,this._alreadyRun*=t/e,this._line.style.left=this._alreadyRun+"px",this._scrollContainer.scrollLeft*=t/e}}]),t}(),F={components:{piano:N},props:{mode:{type:String,default:"LABEL_MODE"},taskId:{type:Number,default:0}},data:function(){return{tmpvalue:"",playing:!1,tracks:[],showTrack:{},update:!1,value1:!0,MidiHead:{},duration:0,notes:[],roll:null,userToBeCheckedName:"",studyNumAll:0,studyNumPass:0,checkBtnAttr:!0,addButtonAttr:!0,checkUserId:"",checkUserName:"",audioName:"",getButtonAttr:!1,submitButtonAttr:!0,abandonButtonAttr:!0,labelDataOrigin:[],labelData:[],datetime:"",lyricsItems:[],lyricsSaveItems:[],tablePageLength:6,currentPage:1,uid:null,itemId:null,wavesurfer:null,value:400,appointTime:0,rate:1,pixel:20,getTaskTime:0,submitTaskTime:"",taskIdShow:!1,dialogVisible:!1,errorDesOptions:[],errOptionObj:{},errorDes:null,fontSize:14,fontSizeStyle:"fontSizeOne",previewTime:.5,trueResult:"",errThre:0,errNumThre:0,errData:[],errDataVisible:!1,rePaintTable:!0,flagArr:[],errDescriptions:[],labelUserName:"",isModified:null,wvBackgroundColor:"rgba(48, 65, 86,1)",wvWaveColor:"rgba(192,196,204,1)",wvProgressColor:"rgba(190,237,199,1)",flashWaveColor:!0,flashProgressColor:!0,waveScrollLeft:0,waveDuration:0}},computed:{containerTimeLength:function(){return document.getElementById("waveform").offsetWidth/this.value},scrolledTime:function(){return this.waveScrollLeft/this.value}},beforeMount:function(){this.readStorage()},mounted:function(){var t=this,e=this;e.containerWidth=document.getElementById("waveform").offsetWidth,window.onresize=function(){e.containerWidth=document.getElementById("waveform").offsetWidth},window.addEventListener("beforeunload",(function(){t.writeStroage()})),this.value=200,this.$nextTick((function(){t.wavesurfer=f.a.create({container:t.$refs.waveform,autoCenter:!1,partialRender:!0,pixelRatio:1,backgroundColor:t.wvBackgroundColor,cursorColor:"white",waveColor:t.wvWaveColor,progressColor:t.wvProgressColor,backend:"MediaElement",mediaControls:!1,audioRate:"1",scrollParent:!0,fillParent:!1,hideScrollbar:!1,responsive:!0,plugins:[m.a.create({showTime:!0,color:"white",opacity:1,customStyle:{width:"21px",top:"60px",bottom:"60px","margin-left":"80px"},customShowTimeStyle:{"background-color":"#000",color:"#fff",padding:"2px","font-size":"10px",marginTop:"45px"}}),p.a.create({container:"#wave-timeline"}),y.a.create({regions:[],maxRegions:1,slop:5})]}),t.wavesurfer.on("seek",(function(e){t.roll.changeSeek(e*t.waveDuration*t.value)})),t.wavesurfer.on("scroll",(function(e){t.roll.changeScrollLeft(e.target.scrollLeft)})),t.wavesurfer.on("audioprocess",(function(e){t.waveScrollLeft=t.wavesurfer.drawer.wrapper.scrollLeft,t.roll&&t.roll.changeLineLeft(e,t.containerTimeLength,t.scrolledTime,t.waveScrollLeft,t.waveDuration),t.scrolledTime+t.containerTimeLength<e&&e<=t.waveDuration-t.containerTimeLength?t.wavesurfer.drawer.wrapper.scrollLeft=t.waveScrollLeft+document.getElementById("waveform").offsetWidth:e<t.scrolledTime?t.wavesurfer.drawer.wrapper.scrollLeft=e*t.value:e>t.waveDuration-t.containerTimeLength&&(t.wavesurfer.drawer.wrapper.scrollLeft=(t.waveDuration-t.containerTimeLength)*t.value)}));var e=t;document.fastKey=function(){var t=window.event.keyCode;37==t?e.backward():39==t?e.forward():32==t?e.playMusic():27==t?e.clearRegs():13==t?e.playSelect():65==t?e.pageUp():68==t&&e.pageDown()},document.addEventListener("keydown",document.fastKey),t.wavesurfer.enableDragSelection({id:1,color:"rgba(55,188,201,0.5)",handleStyle:{left:{backgroundColor:"rgba(255,255,255,1)"},right:{backgroundColor:"rgba(255,255,255,1)"}}}),t.wavesurfer.on("ready",(function(){console.log("readY!"),t.waveDuration=t.duration,t.wavesurfer.zoom(t.value)}))}))},beforeDestroy:function(){document.removeEventListener("keydown",document.fastKey),this.instance&&this.instance.close(),this.writeStroage()},methods:{formatTooltip:function(t){return t/100+.5},handleChange:function(){this.playing=!this.playing},onChange:function(){console.log(this.tmpvalue);var t,e=Object(u["a"])(this.tracks);try{for(e.s();!(t=e.n()).done;){var s=t.value;s.index===this.tmpvalue&&(this.showTrack=s)}}catch(o){e.e(o)}finally{e.f()}console.log(this.showTrack),this.roll.update(this.showTrack,this.duration,this.MidiHead)},changeMidi:function(){this.tracks=[],this.getMidi()},getMidi:function(){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,D["Midi"].fromUrl((t.value1,"".concat("/midi-test/","audio/0.mid"))).then((function(e){t.duration=e.duration,t.MidiHead=e.header,console.log(e),e.tracks.forEach((function(e,s){if(0!==e.notes.length){var o=e;o.index=s,t.tracks.push(o)}})),0!==t.tracks.length&&(t.tmpvalue=t.tracks[0].index,t.showTrack=t.tracks[0]),console.log(t.tracks),console.log(t.showTrack)}));case 2:case"end":return e.stop()}}),e)})))()},abandonEventDone:function(){this.getButtonAttr=!1,this.submitButtonAttr=!0},readStorage:function(){if(window.localStorage){var t=window.localStorage;this.wvBackgroundColor=t.getItem("backgroundColor")?t.getItem("backgroundColor"):"rgba(48, 65, 86,1)",this.wvWaveColor=t.getItem("waveColor")?t.getItem("waveColor"):"rgba(192,196,204,1)",this.wvProgressColor=t.getItem("progressColor")?t.getItem("progressColor"):"rgba(190,237,199,1)"}else this.$message({message:"您的浏览器不支持缓存，建议使用最新Chrome浏览器！",type:"warning"})},writeStroage:function(){if(window.localStorage){var t=window.localStorage;t.setItem("backgroundColor",this.wvBackgroundColor),t.setItem("waveColor",this.wvWaveColor),t.setItem("progressColor",this.wvProgressColor)}else this.$message({message:"您的浏览器不支持缓存，建议使用最新Chrome浏览器！",type:"warning"})},changeBackgroundColor:function(t){this.wvBackgroundColor=t,this.wavesurfer.setBackgroundColor(this.wvBackgroundColor)},changeWaveColor:function(t){this.wvWaveColor=t,this.wavesurfer.setWaveColor(this.wvWaveColor),this.flashWaveColor=!this.flashWaveColor,this.flashWaveColor?this.wavesurfer.zoom(this.value+1):this.wavesurfer.zoom(this.value-1)},changeProgressColor:function(t){this.wvProgressColor=t,this.wavesurfer.setProgressColor(this.wvProgressColor),this.flashProgressColor=!this.flashProgressColor,this.flashProgressColor?this.wavesurfer.zoom(this.value+.5):this.wavesurfer.zoom(this.value-.5)},resetColor:function(){this.changeBackgroundColor("rgba(48, 65, 86,1)"),this.changeWaveColor("rgba(192,196,204,1)"),this.changeProgressColor("rgba(190,237,199,1)")},playMusic:function(){this.wavesurfer.playPause.bind(this.wavesurfer)(),this.playing=!this.playing,this.playing?this.roll.start():this.roll.stop()},changeZoom:function(t,e){this.wavesurfer.zoom(this.value),this.roll.changeXAxis(t,e),this.roll.update(this.showTrack,this.duration,this.MidiHead),this.playing&&this.roll.start()},changeLong:function(){this.value=this.value+this.pixel,this.wavesurfer.zoom(this.value)},changeLongHotKey:function(){this.roll.changeXAxis(400,this.value),this.roll.update(this.showTrack,this.duration,this.MidiHead),this.playing&&this.roll.start(),this.value=400,this.wavesurfer.zoom(this.value)},changeShort:function(){this.value<=80?this.$message({message:"无法再缩小了!",type:"warning"}):(this.value=this.value-this.pixel,this.wavesurfer.zoom(this.value))},changeShortHotKey:function(){this.roll.changeXAxis(80,this.value),this.roll.update(this.showTrack,this.duration,this.MidiHead),this.playing&&this.roll.start(),this.value=80,this.wavesurfer.zoom(this.value)},forward:function(){this.wavesurfer.skip(.5)},backward:function(){this.wavesurfer.skip(-.5)},clearRegs:function(){this.wavesurfer.clearRegions()},changeSpace:function(){this.wavesurfer.setPlaybackRate(this.rate)},playSelect:function(){if(0==Object.keys(this.wavesurfer.regions.list).length)this.$message({message:"请先选择一段音频",type:"warning"});else{var t=0,e=0;for(var s in this.wavesurfer.regions.list)t=this.wavesurfer.regions.list[s].start.toFixed(2),e=this.wavesurfer.regions.list[s].end.toFixed(2);this.wavesurfer.play(t,e)}},addSelect:function(t){if(0==Object.keys(this.wavesurfer.regions.list).length)this.$message({message:"请先选择一段音频",type:"warning"});else{var e=0,s=0;for(var o in this.wavesurfer.regions.list)e=this.wavesurfer.regions.list[o].start.toFixed(2),s=this.wavesurfer.regions.list[o].end.toFixed(2);t.labelTimeStart=e,t.labelTimeEnd=s}},preview:function(){var t=this,e=this.wavesurfer.getCurrentTime();this.wavesurfer.play(e,e+this.previewTime);var s=1/this.rate*this.previewTime*1e3;setTimeout((function(){t.wavesurfer.play(e,e)}),s)},getTask:function(){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getMidi();case 2:return t.containerWidth=document.getElementById("waveform").offsetWidth,null!==t.roll?console.log("update"):(console.log("new"),console.log(t.MidiHead),t.roll=new $(t.MidiHead,t.wavesurfer),t.roll.setScore(t.showTrack,t.duration)),t.update=!0,t.playing&&t.roll.start(),t.currentPage=1,t.labelData=[],s=new Date,t.getTaskTime=Date.now(),t.datetime=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate(),e.next=13,t.wavesurfer.load("".concat("/midi-test/","audio/0.wav"));case 13:t.wavesurfer.zoom(t.value),t.itemId=null,t.audioName="".concat("/midi-test/","audio/0.wav").split("/").slice(-1)[0],t.uid=113889,"LABEL_MODE"==t.mode&&(t.lyricsSaveItems=[]),t.taskIdShow=!0,t.getButtonAttr=!0,t.submitButtonAttr=!1,t.checkBtnAttr=!1,t.abandonButtonAttr=!1,t.clearRegs();case 24:case"end":return e.stop()}}),e)})))()}}},X=F,Y=(s("4c7f"),Object(W["a"])(X,l,c,!1,null,"f76de944",null)),J=Y.exports,G={name:"MidiDemo",data:function(){return{}},components:{Waveform:J}},V=G,Z=(s("d8f3"),Object(W["a"])(V,n,a,!1,null,"36f5fc34",null)),q=Z.exports,Q={name:"App",components:{MidiDemo:q}},tt=Q,et=(s("034f"),Object(W["a"])(tt,i,r,!1,null,null,null)),st=et.exports,ot=s("5c96"),it=s.n(ot),rt=(s("0fae"),s("2f62"));o["default"].use(rt["a"]);var nt=new rt["a"].Store({state:{},mutations:{},actions:{}});o["default"].config.productionTip=!1,o["default"].use(it.a),new o["default"]({store:nt,render:function(t){return t(st)}}).$mount("#app")},"66ab":function(t,e,s){},"85ec":function(t,e,s){},9747:function(t,e,s){"use strict";s("519a")},c82b:function(t,e,s){},d8f3:function(t,e,s){"use strict";s("66ab")}});
//# sourceMappingURL=app.49505c7e.js.map